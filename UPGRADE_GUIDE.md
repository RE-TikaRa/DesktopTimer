# DesktopTimer 升级指南

## v1.0.0 → v1.0.1 升级说明

### 🔄 自动兼容处理

程序在首次运行 v1.0.1 时会**自动处理**旧版本的设置文件，无需手动操作。

### ✨ 兼容性功能

#### 1. **声音文件路径自动转换**
   - **旧版本 (v1.0.0)**: 使用绝对路径
     ```json
     "sound_file": "C:/Program Files/DesktopTimer/sounds/Alarm01.wav"
     ```
   
   - **新版本 (v1.0.1)**: 自动转换为相对路径
     ```json
     "sound_file": "sounds/Alarm01.wav"
     ```
   
   - **处理逻辑**:
     - 如果检测到绝对路径，且文件在 `sounds/` 文件夹内
     - 自动转换为相对路径并保存
     - 提高程序的可移植性

#### 2. **新配置项自动添加**
   新版本添加的时钟模式配置会自动添加到旧设置文件：
   ```json
   "clock_format_24h": true,
   "clock_show_seconds": true,
   "clock_show_date": true
   ```

#### 3. **用户设置完全保留**
   以下设置在升级时**完全保留**：
   - ✅ 字体和字体大小
   - ✅ 文字颜色和背景颜色
   - ✅ 背景透明度
   - ✅ 倒计时预设时间
   - ✅ 语言设置
   - ✅ 铃声选择
   - ✅ 圆角窗口设置
   - ✅ 所有其他自定义设置

### 📦 安装方式

#### 方式 1: 直接安装（推荐）
1. 运行 `DesktopTimer-Setup.exe`
2. 安装程序会自动检测旧版本
3. 直接覆盖升级，无需卸载
4. 首次运行时自动转换设置

#### 方式 2: 手动覆盖
1. 关闭正在运行的 DesktopTimer v1.0.0
2. 备份 `C:\Program Files\DesktopTimer\settings\` 文件夹（可选）
3. 解压新版本到旧版本目录
4. 覆盖 `DesktopTimer.exe` 和 `lang/`、`img/` 文件夹
5. **保留** `settings/` 和自定义的 `sounds/` 文件

### 🛡️ 数据保护

安装程序配置了以下保护措施：

1. **settings 文件夹**: 卸载时不会删除
2. **自定义铃声**: 不会被新铃声覆盖
3. **用户配置**: 升级时完全保留

### ⚠️ 注意事项

#### 如果声音文件路径转换失败：
可能的原因：
- 声音文件不在程序安装目录的 `sounds/` 文件夹内
- 声音文件路径跨盘符（如 D:\sounds\alarm.wav）

解决方法：
- 程序会保持原来的绝对路径，继续正常工作
- 建议将外部铃声文件复制到 `sounds/` 文件夹内

#### 第一次运行新版本时：
- 可能会看到控制台输出：`[兼容] 已将声音文件路径从绝对路径转换为相对路径`
- 这是正常现象，表示自动转换成功

### 🔧 故障排除

#### 问题：升级后铃声不响了
**解决**：
1. 打开设置，检查铃声文件是否正确
2. 点击"测试铃声"按钮
3. 如果提示找不到文件，重新选择铃声

#### 问题：升级后设置丢失了
**解决**：
1. 检查 `C:\Program Files\DesktopTimer\settings\timer_settings.json` 是否存在
2. 如果文件存在，但设置没有加载，尝试删除该文件让程序重新生成
3. 如果之前有备份，恢复备份文件

#### 问题：语言变成英文了
**解决**：
1. 打开设置 → 常规设置
2. 语言选择"简体中文"
3. 点击应用

### 📝 版本对比

| 功能 | v1.0.0 | v1.0.1 |
|------|--------|--------|
| 路径处理 | 绝对路径 | 相对路径（自动转换） |
| 窗口锁定 | ✅ | ✅（修复翻译） |
| 时钟模式 | ✅ | ✅ |
| 编译方式 | onedir | onefile |
| 便携性 | ❌ | ✅ |

### 🎯 推荐操作

升级后建议操作：
1. ✅ 首次运行，确认设置已正确加载
2. ✅ 测试铃声是否正常播放
3. ✅ 测试倒计时功能
4. ✅ 测试窗口锁定功能（Ctrl+L）
5. ✅ 如果一切正常，可以删除旧版本的备份

---

**问题反馈**: https://github.com/RE-TikaRa/DesktopTimer/issues
